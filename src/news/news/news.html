<app-back-button></app-back-button>
<div class="container mx-auto bg-stone-900 rounded-none shadow-2xl overflow-hidden pb-12 border border-stone-800">
  <!-- Header Image -->
  @if (data.images?.Gallery && data.images!.Gallery.length > 0) {
    <div class="relative h-96 w-full group">
      <!-- Using the first image as the main header image -->
      <img [src]="data.images!.Gallery[0].asset.url" [alt]="data.images!.Gallery[0].alt || data.title" class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-700">
      <div class="absolute inset-0 bg-linear-to-t from-black via-black/50 to-transparent"></div>
      <div class="absolute bottom-0 left-0 p-8 w-full">
        <div class="border-l-4 border-red-600 pl-6 mb-4">
          <h1 class="text-4xl md:text-5xl font-black text-white uppercase tracking-tighter mb-2 drop-shadow-lg">{{ data.title }}</h1>
        </div>
        <div class="flex items-center gap-6 text-sm uppercase tracking-widest">
          <span class="text-red-500 font-bold bg-black/50 px-3 py-1">{{ data.date | date:'longDate' }}</span>
          @if (data.author) {
            <span class="text-gray-300 font-light">Por <span class="text-white font-bold">{{ data.author }}</span></span>
          }
        </div>
      </div>
    </div>
  } @else {
    <div class="p-12 border-b border-stone-800 bg-stone-900">
      <div class="border-l-4 border-red-600 pl-6 mb-6">
        <h1 class="text-4xl md:text-5xl font-black text-white uppercase tracking-tighter mb-2">{{ data.title }}</h1>
      </div>
      <div class="flex items-center gap-6 text-sm uppercase tracking-widest text-gray-400">
        <span class="text-red-500 font-bold">{{ data.date | date:'longDate' }}</span>
        @if (data.author) {
          <span>Por <span class="text-white font-bold">{{ data.author }}</span></span>
        }
      </div>
    </div>
  }

  <div class="p-8 md:p-12 xl:p-20 bg-stone-900 text-gray-300">
    <!-- Short Description -->
    <p class="text-xl md:text-2xl text-gray-100 font-light leading-relaxed mb-10 border-l-4 border-red-600 pl-6 italic">
      {{ data.short_description }}
    </p>

    <!-- Full Description (if available) -->
    @if (data.description) {
      <div class="prose prose-invert prose-lg max-w-none mb-10 font-light text-gray-300">
        <p>{{ data.description }}</p>
      </div>
    }

    <!-- Body Content (Block Content) -->
    @if (data.body) {
      <div class="prose prose-invert prose-lg max-w-none text-gray-300 space-y-6">
        @for (block of data.body; track block._key) {
          @if (block._type === 'block') {
            @if (block.style === 'h1') {
              <h1 class="text-4xl font-black text-white mt-12 mb-6 uppercase tracking-tighter pb-2">
                @for (child of block.children; track child._key) {
                  <ng-container *ngTemplateOutlet="spanRenderer; context: {$implicit: child, markDefs: block.markDefs}"></ng-container>
                }
              </h1>
            } @else if (block.style === 'h2') {
              <h2 class="text-3xl font-bold text-white mt-10 mb-5 uppercase tracking-wide flex items-center">
                @for (child of block.children; track child._key) {
                  <ng-container *ngTemplateOutlet="spanRenderer; context: {$implicit: child, markDefs: block.markDefs}"></ng-container>
                }
              </h2>
            } @else if (block.style === 'h3') {
              <h3 class="text-2xl font-bold text-gray-200 mt-8 mb-4">
                @for (child of block.children; track child._key) {
                  <ng-container *ngTemplateOutlet="spanRenderer; context: {$implicit: child, markDefs: block.markDefs}"></ng-container>
                }
              </h3>
            } @else if (block.listItem === 'bullet') {
              <ul class="list-disc list-inside pl-4 space-y-2 marker:text-red-500">
                <li class="text-gray-300">
                  @for (child of block.children; track child._key) {
                    <ng-container *ngTemplateOutlet="spanRenderer; context: {$implicit: child, markDefs: block.markDefs}"></ng-container>
                  }
                </li>
              </ul>
            } @else if (block.listItem === 'number') {
              <ol class="list-decimal list-inside pl-4 space-y-2 marker:text-red-500 marker:font-bold">
                <li class="text-gray-300">
                  @for (child of block.children; track child._key) {
                    <ng-container *ngTemplateOutlet="spanRenderer; context: {$implicit: child, markDefs: block.markDefs}"></ng-container>
                  }
                </li>
              </ol>
            } @else {
              <p class="leading-relaxed mb-4">
                @for (child of block.children; track child._key) {
                  <ng-container *ngTemplateOutlet="spanRenderer; context: {$implicit: child, markDefs: block.markDefs}"></ng-container>
                }
              </p>
            }
          }
          @if (block._type === 'image') {
             <div class="my-8">
               <img [src]="block.asset?.url" [alt]="block.alt" class="w-full h-auto rounded-none border border-stone-700 grayscale hover:grayscale-0 transition-all duration-500 shadow-lg"/>
             </div>
          }
        }
      </div>
    }

    <!-- Gallery (Rest of the images) -->
    @if (data.images?.Gallery && data.images!.Gallery.length > 1) {
      <div class="mt-16 pt-10 border-t border-stone-800">
        <h3 class="text-3xl font-black text-white mb-8 uppercase tracking-wide flex items-center">
          <span class="w-8 h-1 bg-red-600 mr-4"></span> Galer√≠a
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          <!-- Skipping the first one as it is used in header -->
          @for (img of data.images!.Gallery.slice(1); track img._key) {
            <div class="relative h-64 overflow-hidden group cursor-pointer border border-stone-800">
              <img [src]="img.asset.url" [alt]="img.alt || 'Gallery image'" class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-500 transform group-hover:scale-110">
              <div class="absolute inset-0 bg-black/20 group-hover:bg-transparent transition-colors duration-300"></div>
            </div>
          }
        </div>
      </div>
    }
  </div>
</div>

<ng-template #spanRenderer let-child let-markDefs="markDefs">
  @if (child.marks && child.marks.length > 0) {
    @if (getLink(child.marks[0], markDefs); as link) {
      <a [href]="link" target="_blank" class="text-violet-500 hover:text-violet-400 underline decoration-violet-500/50 hover:decoration-violet-400 transition-colors font-medium">
        <span [class.font-bold]="child.marks?.includes('strong')" [class.italic]="child.marks?.includes('em')">{{ child.text }}</span>
      </a>
    } @else {
      <span [class.font-bold]="child.marks?.includes('strong')" [class.italic]="child.marks?.includes('em')">{{ child.text }}</span>
    }
  } @else {
    {{ child.text }}
  }
</ng-template>
